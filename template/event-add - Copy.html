<div class="container" ng-controller="AddEventCtrl">
	<div class="h45p"></div>
	
	<form name="addEvent" novalidate method="POST" action="add.php">
		<div class="clr"><br/></div>
		<div class="col-lg-2">
			<span class="btn-file">
				<i class="fa fa-picture-o blue"></i>
				<input name="event_image" type="file">
			</span>
		</div>
		<div class="col-lg-6">
			<!-- title -->
			<div class="form-group" ng-class="{ 'has-error' : addEvent.event_title.$invalid && !addEvent.event_title.$pristine }">
				Назва події <span class="color-red">*</span>:
				<input type="text" name="event_title" placeholder="Event Title" ng-model="event.event_title" required>
            	<p ng-show="addEvent.event_title.$invalid && !addEvent.event_title.$pristine" class="help-block">Title is required.</p>
				<div class="clr mb10"></div>
			</div>

			<!-- category -->
			<div class="form-group" ng-class="{ 'has-error' : addEvent.event_category.$invalid && !addEvent.event_category.$pristine }">
				Категорія <span class="color-red">*</span>:
				<select  name="event_category" ng-model="event.event_category" required>
					<option value="1">музика</option>
					<option value="2">кіно</option>
					<option value="3">виставки</option>
					<option value="4">театр</option>
					<option value="5">фестивалі</option>
					<option value="6">лекції/презентації</option>
					<option value="7">інше</option>
				</select>
				<p ng-show="addEvent.event_category.$invalid && !addEvent.event_category.$pristine" class="help-block">Category is required.</p>
				<div class="clr mb10"></div>
			</div>

			<!-- Location -->
			<div class="form-group" ng-class="{ 'has-error' : addEvent.event_location.$invalid && !addEvent.event_location.$pristine }">
				<i class="fa fa-map-marker blue"></i> Місце проведення <span class="color-red">*</span>:
				<input type="text" name="event_location" placeholder="Event location" ng-model="event.event_location" required>
				<p ng-show="addEvent.event_location.$invalid && !addEvent.event_location.$pristine" class="help-block">Location is required.</p>
				<div class="clr mb10"></div>
			</div>
			<!-- location addr -->
			<div class="form-group" ng-class="{ 'has-error' : addEvent.event_location_addr.$invalid && !addEvent.event_location_addr.$pristine }">
				Адреса <span class="color-red">*</span>:<br/>
				<input id="geocomplete" type="text" placeholder="Type location address" name="event_location_addr" value="" class="fl mr10" style="width: 60%; "  ng-model="event.event_location_addr" required>
				<input id="find" type="button" value="Знайти" class="fl btn" style="width: 15%; padding: 6px 0;" />
				<a id="reset" class="fl btn" href="#" style="display:none; width: 20%;">Стерти</a>
				<div class="clr"></div>
				<p ng-show="addEvent.event_location_addr.$invalid && !addEvent.event_location_addr.$pristine" class="help-block">Location is required.</p>
			</div>
		</div>	
		<div class="col-lg-4">
			<br/>
			<div id="event-map" class="events-add-map" style="width: 100%; height: 210px;"></div>
			* виможете переміщати маркер
			<div style="height:1px; overflow:hidden;"> 
				<input name="lat" type="text" value="" class="" />
				<input name="lng" type="text" value="" class="" />
				<input name="event_location_formatted_address" type="text" value="" />
			</div>
		</div>
		<div class="clr "></div>

		<div class="col-lg-8">
			<i class="fa fa-calendar blue"></i> Виберіть дату <span class="color-red">*</span>:
			<div class="clr"></div>
	        <!--<input type="text" name="event_startdate" placeholder=""  value="" id="events-add-startdate" required>-->
	        <div id="events-add-startdate-container" class="dib fl mr10" required></div>
	        <span id="dates" class="dib"></span>
	        <!--<input id="timefrom"> <input id="timetill">-->
	        <input name="event_dates" id="event_dates" value="">
			<div class="clr mb10"></div>
		</div>
		<div class="col-lg-4">
			<i class="fa fa-ticket blue"></i> Вартість квитків:
			<input type="text" name="event_tickets" placeholder="Free or ticket price" >
			<div class="clr mb10"></div>

			сайт:
			<input type="text" name="event_web" placeholder="Event website" >
			<div class="clr mb10"></div>

			e-mail:
			<input type="text" name="event_email" placeholder="e-mail" >
			<div class="clr mb10"></div>

			телефон:
			<input type="text" name="event_phone" placeholder="phone" >
			<div class="clr mb10"></div>
		</div>
		<div class="clr "></div>

		<div class="col-lg-8">
			<!-- description -->
			<div class="form-group" ng-class="{ 'has-error' : addEvent.event_description.$invalid && !addEvent.event_description.$pristine }">
				Опис події <span class="color-red">*</span>:
				<textarea  name="event_description" rows="15" placeholder="Event Description" ng-model="event.event_description" required></textarea>
				<p ng-show="addEvent.event_description.$invalid && !addEvent.event_description.$pristine" class="help-block">Description is required.</p>
				<div class="clr mb10"></div>
			</div>
			<button type="submit" name="submit" class="btn" id="event_submit" ng-disabled="addEvent.$invalid"><i class="fa fa-check"></i> Додати подію</button>
			<button class="btn" id="event_submit_btn" ><i class="fa fa-check"></i> test</button>
		</div>
		<div class="clr "><br/></div>
	<form>
</div>
<div class="clr "><br/></div>


<script>
 	 $(function (){
        $("#geocomplete").geocomplete({
          map: "#event-map",
          details: "form",
          mapOptions: {
		    zoom: 16
		  },
          markerOptions: {
            draggable: true
          }
        });
        
        $("#geocomplete").bind("geocode:dragged", function(event, latLng){
          $("input[name=lat]").val(latLng.lat());
          $("input[name=lng]").val(latLng.lng());
          $("#reset").show();
        });
        
        
        $("#reset").click(function(){
          $("#geocomplete").geocomplete("resetMarker");
          $("#reset").hide();
          return false;
        });
        
        $("#find").click(function(){
          $("#geocomplete").trigger("geocode");
        }).click();
	});

	$(function(){

		var i = 1;

		$('#events-add-startdate-container').datepicker(
			{
				altField: "#events-add-startdate",
		    	altFormat: "yy-mm-dd",
		    	dateFormat: "DD, d MM yy",
		    	minDate: new Date(),
		    	onSelect:function(date) {
            		$('#dates').append('<div class="select_date" id="'+date+'"><i class="fa fa-times"></i><span style="width: 200px;">' + date + '</span><input id="timefrom_'+i+'" value=""> <input id="timetill_'+i+'" value=""></div');
            		$('#timefrom_'+i+'').timepicker({ 'timeFormat': 'H:i','step': 15 });
					$('#timetill_'+i+'').timepicker({ 'timeFormat': 'H:i','step': 15 });
					i++;
        		}
			});
		
		$('#event_submit').click(function(){			
			/*
			$dates = $('#dates .select_date').map(function() {
		    	return ('{"date":"' + moment(this.id, "dddd, D MMMM YYYY").format("YYYY-MM-DD") + '", "timefrom": "'+ $("#timefrom_"+i).val() +'", "timetill": "'+ $("#timetill_"+i).val() +'"}');
			})
			.get()
			.join( ", " ) */
			$dates = $('#dates .select_date').map(function () {
			    var date = moment(this.id, "dddd, D MMMM YYYY").format("YYYY-MM-DD"),
			        timeFrom = $($(this).find('input')[0]).val(),
			        timeTill = $($(this).find('input')[1]).val(),
			        result = {
			            date: date,
			            timefrom: timeFrom,
			            timetill: timeTill
			        };

			    return JSON.stringify(result);
			}).get().join(", ");

			$('#event_dates').val($.makeArray($dates))
		});
	});
</script>